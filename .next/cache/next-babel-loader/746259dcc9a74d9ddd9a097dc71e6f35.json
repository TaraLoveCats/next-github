{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _Button from \"antd/lib/button\";\nimport _Tabs from \"antd/lib/tabs\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useSelector } from 'react-redux';\nimport { useState, useEffect } from 'react';\nimport Repo from '../components/Repo';\nimport config from '../config';\nimport LRU from 'lru-cache';\nimport Router, { useRouter } from 'next/router';\nvar OAUTH_URL = config.OAUTH_URL;\nvar TabPane = _Tabs.TabPane;\nvar cache = new LRU({\n  maxAge: 1000 * 60 * 30 //30min\n\n});\nvar isServer = false;\nexport default function Index(_ref) {\n  var loggedIn = _ref.loggedIn,\n      userRepos = _ref.userRepos,\n      userStarredRepos = _ref.userStarredRepos;\n  // const user = useSelector(state => state.user);\n  // const initLoggedIn = user && user.id;\n  // const [userRepos, setUserRepos] = useState([]);\n  // const [userStarredRepos, setUserStarredRepos] = useState([]);\n  // const [loggedIn, setLoggedIn] = useState(initLoggedIn);\n  var router = useRouter();\n  var activeTabKey = router.query.key || 'repos';\n\n  var handleTabChange = function handleTabChange(activeTabKey) {\n    Router.push(\"/?key=\".concat(activeTabKey));\n  }; // useEffect(() => {\n  //     if (loggedIn) { \n  //         if (cache.get('userRepos') && cache.get('userStarredRepos')) {\n  //             return;\n  //         }\n  //         (async () => {\n  //             const userRepos = await api.request(\n  //                 { url: '/user/repos' }, \n  //             )\n  //             const userStarredRepos = await api.request(\n  //                 { url: '/user/starred' }\n  //             )\n  //             setUserRepos(userRepos.data);\n  //             setUserStarredRepos(userStarredRepos.data)\n  //         })()\n  //     }\n  // }, [loggedIn])\n\n\n  useEffect(function () {\n    if (!isServer) {\n      //服务端环境不使用缓存\n      userRepos && cache.set('userRepos', userRepos);\n      userStarredRepos && cache.set('userStarredRepos', userStarredRepos);\n    }\n  }, [userRepos, userStarredRepos]);\n\n  var BeforeLogin = function BeforeLogin() {\n    return __jsx(React.Fragment, null, __jsx(\"div\", {\n      className: \"jsx-449660228\" + \" \" + \"root\"\n    }, __jsx(_Button, {\n      href: OAUTH_URL,\n      onClick: function onClick() {\n        return setLoggedIn(true);\n      }\n    }, \"\\u672A\\u767B\\u5F55\\uFF0C\\u8BF7\\u70B9\\u51FB\\u767B\\u5F55\")), __jsx(_JSXStyle, {\n      id: \"449660228\"\n    }, \".root.jsx-449660228{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkQ6XFznvJbnqItcXOmhueebrlxcbmV4dOmhueebrlxcbmV4dC1naXRodWJcXHBhZ2VzXFxpbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUE0RGUsQUFHbUIsMEVBQ1UsbUdBQ0osNkZBQ3BCIiwiZmlsZSI6IkQ6XFznvJbnqItcXOmhueebrlxcbmV4dOmhueebrlxcbmV4dC1naXRodWJcXHBhZ2VzXFxpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZVNlbGVjdG9yIH0gZnJvbSAncmVhY3QtcmVkdXgnXHJcbmltcG9ydCB7IEJ1dHRvbiwgVGFicyB9IGZyb20gJ2FudGQnXHJcbmltcG9ydCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QgfSBmcm9tICdyZWFjdCdcclxuaW1wb3J0IFJlcG8gZnJvbSAnLi4vY29tcG9uZW50cy9SZXBvJ1xyXG5pbXBvcnQgY29uZmlnIGZyb20gJy4uL2NvbmZpZydcclxuaW1wb3J0IExSVSBmcm9tICdscnUtY2FjaGUnXHJcbmltcG9ydCAgUm91dGVyLCB7IHVzZVJvdXRlciB9IGZyb20gJ25leHQvcm91dGVyJ1xyXG5cclxuY29uc3QgeyBPQVVUSF9VUkwgfSA9IGNvbmZpZztcclxuY29uc3QgeyBUYWJQYW5lIH0gPSBUYWJzO1xyXG5jb25zdCBjYWNoZSA9IG5ldyBMUlUoe1xyXG4gICAgbWF4QWdlOiAxMDAwICogNjAgKiAzMCAvLzMwbWluXHJcbn0pXHJcbmNvbnN0IGlzU2VydmVyID0gdHlwZW9mIHdpbmRvdyA9PT0gdW5kZWZpbmVkXHJcblxyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBJbmRleCh7IGxvZ2dlZEluLCB1c2VyUmVwb3MsIHVzZXJTdGFycmVkUmVwb3MgfSkge1xyXG4gICAgLy8gY29uc3QgdXNlciA9IHVzZVNlbGVjdG9yKHN0YXRlID0+IHN0YXRlLnVzZXIpO1xyXG4gICAgLy8gY29uc3QgaW5pdExvZ2dlZEluID0gdXNlciAmJiB1c2VyLmlkO1xyXG4gICAgLy8gY29uc3QgW3VzZXJSZXBvcywgc2V0VXNlclJlcG9zXSA9IHVzZVN0YXRlKFtdKTtcclxuICAgIC8vIGNvbnN0IFt1c2VyU3RhcnJlZFJlcG9zLCBzZXRVc2VyU3RhcnJlZFJlcG9zXSA9IHVzZVN0YXRlKFtdKTtcclxuICAgIC8vIGNvbnN0IFtsb2dnZWRJbiwgc2V0TG9nZ2VkSW5dID0gdXNlU3RhdGUoaW5pdExvZ2dlZEluKTtcclxuICAgIGNvbnN0IHJvdXRlciA9IHVzZVJvdXRlcigpO1xyXG4gICAgY29uc3QgYWN0aXZlVGFiS2V5ID0gcm91dGVyLnF1ZXJ5LmtleSB8fCAncmVwb3MnO1xyXG5cclxuICAgIGNvbnN0IGhhbmRsZVRhYkNoYW5nZSA9IChhY3RpdmVUYWJLZXkpID0+IHtcclxuICAgICAgICBSb3V0ZXIucHVzaChgLz9rZXk9JHthY3RpdmVUYWJLZXl9YClcclxuICAgIH1cclxuXHJcblx0Ly8gdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIC8vICAgICBpZiAobG9nZ2VkSW4pIHsgXHJcbiAgICAvLyAgICAgICAgIGlmIChjYWNoZS5nZXQoJ3VzZXJSZXBvcycpICYmIGNhY2hlLmdldCgndXNlclN0YXJyZWRSZXBvcycpKSB7XHJcbiAgICAvLyAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAvLyAgICAgICAgIH1cclxuICAgIC8vICAgICAgICAgKGFzeW5jICgpID0+IHtcclxuICAgIC8vICAgICAgICAgICAgIGNvbnN0IHVzZXJSZXBvcyA9IGF3YWl0IGFwaS5yZXF1ZXN0KFxyXG4gICAgLy8gICAgICAgICAgICAgICAgIHsgdXJsOiAnL3VzZXIvcmVwb3MnIH0sIFxyXG4gICAgLy8gICAgICAgICAgICAgKVxyXG4gICAgLy8gICAgICAgICAgICAgY29uc3QgdXNlclN0YXJyZWRSZXBvcyA9IGF3YWl0IGFwaS5yZXF1ZXN0KFxyXG4gICAgLy8gICAgICAgICAgICAgICAgIHsgdXJsOiAnL3VzZXIvc3RhcnJlZCcgfVxyXG4gICAgLy8gICAgICAgICAgICAgKVxyXG4gICAgLy8gICAgICAgICAgICAgc2V0VXNlclJlcG9zKHVzZXJSZXBvcy5kYXRhKTtcclxuICAgIC8vICAgICAgICAgICAgIHNldFVzZXJTdGFycmVkUmVwb3ModXNlclN0YXJyZWRSZXBvcy5kYXRhKVxyXG4gICAgLy8gICAgICAgICB9KSgpXHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gfSwgW2xvZ2dlZEluXSlcclxuICAgIFxyXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgICAgICBpZiAoIWlzU2VydmVyKSB7IC8v5pyN5Yqh56uv546v5aKD5LiN5L2/55So57yT5a2YXHJcbiAgICAgICAgICAgIHVzZXJSZXBvcyAmJiBjYWNoZS5zZXQoJ3VzZXJSZXBvcycsIHVzZXJSZXBvcylcclxuICAgICAgICAgICAgdXNlclN0YXJyZWRSZXBvcyAmJiAgY2FjaGUuc2V0KCd1c2VyU3RhcnJlZFJlcG9zJywgdXNlclN0YXJyZWRSZXBvcylcclxuICAgICAgICB9XHJcbiAgICB9LCBbdXNlclJlcG9zLCB1c2VyU3RhcnJlZFJlcG9zXSlcclxuXHJcblx0Y29uc3QgQmVmb3JlTG9naW4gPSAoKSA9PiAoXHJcblx0XHQ8PlxyXG5cdFx0XHQ8ZGl2IGNsYXNzTmFtZT1cInJvb3RcIj5cclxuXHRcdFx0XHQ8QnV0dG9uIGhyZWY9e09BVVRIX1VSTH0gb25DbGljaz17KCkgPT4gc2V0TG9nZ2VkSW4odHJ1ZSl9PlxyXG4gICAgICAgICAgICAgICAgICAgIOacqueZu+W9le+8jOivt+eCueWHu+eZu+W9lVxyXG4gICAgICAgICAgICAgICAgPC9CdXR0b24+XHJcblx0XHRcdDwvZGl2PlxyXG5cdFx0XHQ8c3R5bGUganN4PntgXHJcblx0XHRcdFx0LnJvb3Qge1xyXG5cdFx0XHRcdFx0ZGlzcGxheTogZmxleDtcclxuXHRcdFx0XHRcdGp1c3RpZnktY29udGVudDogY2VudGVyO1xyXG5cdFx0XHRcdFx0YWxpZ24taXRlbXM6IGNlbnRlcjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdGB9PC9zdHlsZT5cclxuXHRcdDwvPlxyXG5cdClcclxuXHRcclxuXHRpZiAoIWxvZ2dlZEluKSB7XHJcblx0XHRyZXR1cm4gPEJlZm9yZUxvZ2luIC8+XHJcblx0fVxyXG5cclxuXHRyZXR1cm4gKFxyXG5cdFx0PD5cclxuXHRcdFx0PGRpdiBjbGFzc05hbWU9XCJyb290XCI+XHJcblx0XHRcdFx0PGRpdiBjbGFzc05hbWU9XCJ1c2VyLWluZm9cIj5cclxuXHRcdFx0XHRcdDxpbWcgc3JjPXt1c2VyLmF2YXRhcl91cmx9IGFsdD1cInVzZXIgYXZhdGFyXCIgY2xhc3NOYW1lPVwidXNlci1hdmF0YXJcIi8+XHJcblx0XHRcdFx0XHQ8cCBjbGFzc05hbWU9XCJ1c2VyLW5hbWVcIj57dXNlci5sb2dpbn08L3A+XHJcblx0XHRcdFx0PC9kaXY+XHJcbiAgICAgICAgICAgICAgICA8VGFicyBhY3RpdmVLZXk9e2FjdGl2ZVRhYktleX0gb25DaGFuZ2U9e2hhbmRsZVRhYkNoYW5nZX0+XHJcbiAgICAgICAgICAgICAgICAgICAgPFRhYlBhbmUga2V5PVwicmVwb3NcIiB0YWI9XCJSZXBvc2l0b3JpZXNcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgey8qIDxkaXYgY2xhc3NOYW1lPVwidXNlci1yZXBvc1wiPiAqL31cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt1c2VyUmVwb3MubWFwKHJlcG8gPT4gPFJlcG8ga2V5PXtyZXBvLmlkfSByZXBvPXtyZXBvfSAvPil9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHsvKiA8L2Rpdj4gKi99XHJcbiAgICAgICAgICAgICAgICAgICAgPC9UYWJQYW5lPlxyXG4gICAgICAgICAgICAgICAgICAgIDxUYWJQYW5lIGtleT1cInN0YXJzXCIgdGFiPVwiU3RhcnNcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAge3VzZXJTdGFycmVkUmVwb3MubWFwKHJlcG8gPT4gPFJlcG8ga2V5PXtyZXBvLmlkfSByZXBvPXtyZXBvfSAvPil9XHJcbiAgICAgICAgICAgICAgICAgICAgPC9UYWJQYW5lPlxyXG4gICAgICAgICAgICAgICAgPC9UYWJzPlxyXG5cdFx0XHQ8L2Rpdj5cclxuXHRcdFx0PHN0eWxlIGpzeD57YFxyXG5cdFx0XHRcdC5yb290IHtcclxuXHRcdFx0XHRcdGRpc3BsYXk6IGZsZXg7XHJcblx0XHRcdFx0XHRhbGlnbi1pdGVtczogZmxleC1zdGFydDtcclxuXHRcdFx0XHRcdHBhZGRpbmc6IDIwcHggMDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0LnVzZXItaW5mbyB7XHJcblx0XHRcdFx0XHR3aWR0aDogMjAwcHg7XHJcblx0XHRcdFx0XHRtYXJnaW4tcmlnaHQ6IDQwcHg7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdC51c2VyLW5hbWUge1xyXG5cdFx0XHRcdFx0Zm9udC1zaXplOiAyMHB4O1xyXG5cdFx0XHRcdFx0Zm9udC13ZWlnaHQ6IDMwMDtcclxuXHRcdFx0XHRcdG1hcmdpbi10b3A6IDEwcHg7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdC51c2VyLWF2YXRhciB7XHJcblx0XHRcdFx0XHR3aWR0aDogMTAwJTtcclxuXHRcdFx0XHRcdGJvcmRlci1yYWRpdXM6IDRweDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdGB9PC9zdHlsZT5cclxuXHRcdDwvPlxyXG5cdClcclxufVxyXG5cclxuY29uc3QgYXBpID0gcmVxdWlyZSgnLi4vbGliL2FwaScpXHJcbi8v6LCD55So77yaIOacjeWKoeerr+a4suafk2luZGV45pe2IC/lrqLmiLfnq6/lr7zoiKrliLBpbmRleOaXtlxyXG4vL+a1j+iniOWZqOeOr+Wig++8miBheGlvcy5nZXQoJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC94eHgnKVxyXG4vL25vZGXnjq/looPvvJogYXhpb3MuZ2V0KCdodHRwOi8vbG9jYWxob3N0OjgwL3h4eCcpXHJcbkluZGV4LmdldEluaXRpYWxQcm9wcyA9IGFzeW5jIChwcm9wcykgPT4ge1xyXG4gICAgY29uc3QgeyBjdHgsIHJlZHV4U3RvcmUgfSA9IHByb3BzXHJcbiAgICBjb25zb2xlLmxvZyhjdHgsIHJlZHV4U3RvcmUpXHJcbiAgICBjb25zb2xlLmxvZygnaW4gaW5kZXggZ2V0SW5pdGl0YWxQcm9wcycpXHJcbiAgICBjb25zdCB1c2VyID0gcmVkdXhTdG9yZS5nZXRTdGF0ZSgpLnVzZXI7XHJcbiAgICBpZiAoIXVzZXIgfHwgIXVzZXIuaWQgKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgbG9nZ2VkSW46IGZhbHNlXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKCFpc1NlcnZlcikgeyAvL+acjeWKoeerr+eOr+Wig+S4jeS9v+eUqOe8k+WtmFxyXG4gICAgICAgIGNvbnN0IHVzZXJSZXBvcyA9IGNhY2hlLmdldCgndXNlclJlcG9zJyk7XHJcbiAgICAgICAgY29uc3QgdXNlclN0YXJyZWRSZXBvcyA9IGNhY2hlLmdldCgndXNlclN0YXJyZWRSZXBvcycpXHJcbiAgICAgICAgaWYgKHVzZXJSZXBvcyAmJiB1c2VyU3RhcnJlZFJlcG9zKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBsb2dnZWRJbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHVzZXJSZXBvcyxcclxuICAgICAgICAgICAgICAgIHVzZXJTdGFycmVkUmVwb3MgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdXNlclJlcG9zUmVzcCA9IGF3YWl0IGFwaS5yZXF1ZXN0KFxyXG4gICAgICAgIHsgdXJsOiAnL3VzZXIvcmVwb3MnIH0sIFxyXG4gICAgICAgIGN0eC5yZXEsIFxyXG4gICAgICAgIGN0eC5yZXNcclxuICAgICk7XHJcbiAgICBjb25zdCB1c2VyU3RhcnJlZFJlcG9zUmVzcCA9IGF3YWl0IGFwaS5yZXF1ZXN0KFxyXG4gICAgICAgIHsgdXJsOiAnL3VzZXIvc3RhcnJlZCd9LFxyXG4gICAgICAgIGN0eC5yZXEsXHJcbiAgICAgICAgY3R4LnJlc1xyXG4gICAgKVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBsb2dnZWRJbjogdHJ1ZSxcclxuICAgICAgICB1c2VyUmVwb3M6IHVzZXJSZXBvc1Jlc3AuZGF0YSxcclxuICAgICAgICB1c2VyU3RhcnJlZFJlcG9zOiB1c2VyU3RhcnJlZFJlcG9zUmVzcC5kYXRhXHJcbiAgICB9XHJcbn1cclxuXHJcbiJdfQ== */\\n/*@ sourceURL=D:\\\\\\\\\\u7F16\\u7A0B\\\\\\\\\\u9879\\u76EE\\\\\\\\next\\u9879\\u76EE\\\\\\\\next-github\\\\\\\\pages\\\\\\\\index.js */\"));\n  };\n\n  if (!loggedIn) {\n    return __jsx(BeforeLogin, null);\n  }\n\n  return __jsx(React.Fragment, null, __jsx(\"div\", {\n    className: \"jsx-1042228906\" + \" \" + \"root\"\n  }, __jsx(\"div\", {\n    className: \"jsx-1042228906\" + \" \" + \"user-info\"\n  }, __jsx(\"img\", {\n    src: user.avatar_url,\n    alt: \"user avatar\",\n    className: \"jsx-1042228906\" + \" \" + \"user-avatar\"\n  }), __jsx(\"p\", {\n    className: \"jsx-1042228906\" + \" \" + \"user-name\"\n  }, user.login)), __jsx(_Tabs, {\n    activeKey: activeTabKey,\n    onChange: handleTabChange\n  }, __jsx(TabPane, {\n    key: \"repos\",\n    tab: \"Repositories\"\n  }, userRepos.map(function (repo) {\n    return __jsx(Repo, {\n      key: repo.id,\n      repo: repo\n    });\n  })), __jsx(TabPane, {\n    key: \"stars\",\n    tab: \"Stars\"\n  }, userStarredRepos.map(function (repo) {\n    return __jsx(Repo, {\n      key: repo.id,\n      repo: repo\n    });\n  })))), __jsx(_JSXStyle, {\n    id: \"1042228906\"\n  }, \".root.jsx-1042228906{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;padding:20px 0;}.user-info.jsx-1042228906{width:200px;margin-right:40px;}.user-name.jsx-1042228906{font-size:20px;font-weight:300;margin-top:10px;}.user-avatar.jsx-1042228906{width:100%;border-radius:4px;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkQ6XFznvJbnqItcXOmhueebrlxcbmV4dOmhueebrlxcbmV4dC1naXRodWJcXHBhZ2VzXFxpbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUE0RmUsQUFHbUIsQUFLRCxBQUlHLEFBS0osV0FDTyxDQVRBLEdBSUYsY0FNakIsQ0FUQSxDQUlpQixnQkFDakIsMkJBWHdCLDZHQUNSLGVBQ2hCIiwiZmlsZSI6IkQ6XFznvJbnqItcXOmhueebrlxcbmV4dOmhueebrlxcbmV4dC1naXRodWJcXHBhZ2VzXFxpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZVNlbGVjdG9yIH0gZnJvbSAncmVhY3QtcmVkdXgnXHJcbmltcG9ydCB7IEJ1dHRvbiwgVGFicyB9IGZyb20gJ2FudGQnXHJcbmltcG9ydCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QgfSBmcm9tICdyZWFjdCdcclxuaW1wb3J0IFJlcG8gZnJvbSAnLi4vY29tcG9uZW50cy9SZXBvJ1xyXG5pbXBvcnQgY29uZmlnIGZyb20gJy4uL2NvbmZpZydcclxuaW1wb3J0IExSVSBmcm9tICdscnUtY2FjaGUnXHJcbmltcG9ydCAgUm91dGVyLCB7IHVzZVJvdXRlciB9IGZyb20gJ25leHQvcm91dGVyJ1xyXG5cclxuY29uc3QgeyBPQVVUSF9VUkwgfSA9IGNvbmZpZztcclxuY29uc3QgeyBUYWJQYW5lIH0gPSBUYWJzO1xyXG5jb25zdCBjYWNoZSA9IG5ldyBMUlUoe1xyXG4gICAgbWF4QWdlOiAxMDAwICogNjAgKiAzMCAvLzMwbWluXHJcbn0pXHJcbmNvbnN0IGlzU2VydmVyID0gdHlwZW9mIHdpbmRvdyA9PT0gdW5kZWZpbmVkXHJcblxyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBJbmRleCh7IGxvZ2dlZEluLCB1c2VyUmVwb3MsIHVzZXJTdGFycmVkUmVwb3MgfSkge1xyXG4gICAgLy8gY29uc3QgdXNlciA9IHVzZVNlbGVjdG9yKHN0YXRlID0+IHN0YXRlLnVzZXIpO1xyXG4gICAgLy8gY29uc3QgaW5pdExvZ2dlZEluID0gdXNlciAmJiB1c2VyLmlkO1xyXG4gICAgLy8gY29uc3QgW3VzZXJSZXBvcywgc2V0VXNlclJlcG9zXSA9IHVzZVN0YXRlKFtdKTtcclxuICAgIC8vIGNvbnN0IFt1c2VyU3RhcnJlZFJlcG9zLCBzZXRVc2VyU3RhcnJlZFJlcG9zXSA9IHVzZVN0YXRlKFtdKTtcclxuICAgIC8vIGNvbnN0IFtsb2dnZWRJbiwgc2V0TG9nZ2VkSW5dID0gdXNlU3RhdGUoaW5pdExvZ2dlZEluKTtcclxuICAgIGNvbnN0IHJvdXRlciA9IHVzZVJvdXRlcigpO1xyXG4gICAgY29uc3QgYWN0aXZlVGFiS2V5ID0gcm91dGVyLnF1ZXJ5LmtleSB8fCAncmVwb3MnO1xyXG5cclxuICAgIGNvbnN0IGhhbmRsZVRhYkNoYW5nZSA9IChhY3RpdmVUYWJLZXkpID0+IHtcclxuICAgICAgICBSb3V0ZXIucHVzaChgLz9rZXk9JHthY3RpdmVUYWJLZXl9YClcclxuICAgIH1cclxuXHJcblx0Ly8gdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIC8vICAgICBpZiAobG9nZ2VkSW4pIHsgXHJcbiAgICAvLyAgICAgICAgIGlmIChjYWNoZS5nZXQoJ3VzZXJSZXBvcycpICYmIGNhY2hlLmdldCgndXNlclN0YXJyZWRSZXBvcycpKSB7XHJcbiAgICAvLyAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAvLyAgICAgICAgIH1cclxuICAgIC8vICAgICAgICAgKGFzeW5jICgpID0+IHtcclxuICAgIC8vICAgICAgICAgICAgIGNvbnN0IHVzZXJSZXBvcyA9IGF3YWl0IGFwaS5yZXF1ZXN0KFxyXG4gICAgLy8gICAgICAgICAgICAgICAgIHsgdXJsOiAnL3VzZXIvcmVwb3MnIH0sIFxyXG4gICAgLy8gICAgICAgICAgICAgKVxyXG4gICAgLy8gICAgICAgICAgICAgY29uc3QgdXNlclN0YXJyZWRSZXBvcyA9IGF3YWl0IGFwaS5yZXF1ZXN0KFxyXG4gICAgLy8gICAgICAgICAgICAgICAgIHsgdXJsOiAnL3VzZXIvc3RhcnJlZCcgfVxyXG4gICAgLy8gICAgICAgICAgICAgKVxyXG4gICAgLy8gICAgICAgICAgICAgc2V0VXNlclJlcG9zKHVzZXJSZXBvcy5kYXRhKTtcclxuICAgIC8vICAgICAgICAgICAgIHNldFVzZXJTdGFycmVkUmVwb3ModXNlclN0YXJyZWRSZXBvcy5kYXRhKVxyXG4gICAgLy8gICAgICAgICB9KSgpXHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gfSwgW2xvZ2dlZEluXSlcclxuICAgIFxyXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgICAgICBpZiAoIWlzU2VydmVyKSB7IC8v5pyN5Yqh56uv546v5aKD5LiN5L2/55So57yT5a2YXHJcbiAgICAgICAgICAgIHVzZXJSZXBvcyAmJiBjYWNoZS5zZXQoJ3VzZXJSZXBvcycsIHVzZXJSZXBvcylcclxuICAgICAgICAgICAgdXNlclN0YXJyZWRSZXBvcyAmJiAgY2FjaGUuc2V0KCd1c2VyU3RhcnJlZFJlcG9zJywgdXNlclN0YXJyZWRSZXBvcylcclxuICAgICAgICB9XHJcbiAgICB9LCBbdXNlclJlcG9zLCB1c2VyU3RhcnJlZFJlcG9zXSlcclxuXHJcblx0Y29uc3QgQmVmb3JlTG9naW4gPSAoKSA9PiAoXHJcblx0XHQ8PlxyXG5cdFx0XHQ8ZGl2IGNsYXNzTmFtZT1cInJvb3RcIj5cclxuXHRcdFx0XHQ8QnV0dG9uIGhyZWY9e09BVVRIX1VSTH0gb25DbGljaz17KCkgPT4gc2V0TG9nZ2VkSW4odHJ1ZSl9PlxyXG4gICAgICAgICAgICAgICAgICAgIOacqueZu+W9le+8jOivt+eCueWHu+eZu+W9lVxyXG4gICAgICAgICAgICAgICAgPC9CdXR0b24+XHJcblx0XHRcdDwvZGl2PlxyXG5cdFx0XHQ8c3R5bGUganN4PntgXHJcblx0XHRcdFx0LnJvb3Qge1xyXG5cdFx0XHRcdFx0ZGlzcGxheTogZmxleDtcclxuXHRcdFx0XHRcdGp1c3RpZnktY29udGVudDogY2VudGVyO1xyXG5cdFx0XHRcdFx0YWxpZ24taXRlbXM6IGNlbnRlcjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdGB9PC9zdHlsZT5cclxuXHRcdDwvPlxyXG5cdClcclxuXHRcclxuXHRpZiAoIWxvZ2dlZEluKSB7XHJcblx0XHRyZXR1cm4gPEJlZm9yZUxvZ2luIC8+XHJcblx0fVxyXG5cclxuXHRyZXR1cm4gKFxyXG5cdFx0PD5cclxuXHRcdFx0PGRpdiBjbGFzc05hbWU9XCJyb290XCI+XHJcblx0XHRcdFx0PGRpdiBjbGFzc05hbWU9XCJ1c2VyLWluZm9cIj5cclxuXHRcdFx0XHRcdDxpbWcgc3JjPXt1c2VyLmF2YXRhcl91cmx9IGFsdD1cInVzZXIgYXZhdGFyXCIgY2xhc3NOYW1lPVwidXNlci1hdmF0YXJcIi8+XHJcblx0XHRcdFx0XHQ8cCBjbGFzc05hbWU9XCJ1c2VyLW5hbWVcIj57dXNlci5sb2dpbn08L3A+XHJcblx0XHRcdFx0PC9kaXY+XHJcbiAgICAgICAgICAgICAgICA8VGFicyBhY3RpdmVLZXk9e2FjdGl2ZVRhYktleX0gb25DaGFuZ2U9e2hhbmRsZVRhYkNoYW5nZX0+XHJcbiAgICAgICAgICAgICAgICAgICAgPFRhYlBhbmUga2V5PVwicmVwb3NcIiB0YWI9XCJSZXBvc2l0b3JpZXNcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgey8qIDxkaXYgY2xhc3NOYW1lPVwidXNlci1yZXBvc1wiPiAqL31cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt1c2VyUmVwb3MubWFwKHJlcG8gPT4gPFJlcG8ga2V5PXtyZXBvLmlkfSByZXBvPXtyZXBvfSAvPil9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHsvKiA8L2Rpdj4gKi99XHJcbiAgICAgICAgICAgICAgICAgICAgPC9UYWJQYW5lPlxyXG4gICAgICAgICAgICAgICAgICAgIDxUYWJQYW5lIGtleT1cInN0YXJzXCIgdGFiPVwiU3RhcnNcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAge3VzZXJTdGFycmVkUmVwb3MubWFwKHJlcG8gPT4gPFJlcG8ga2V5PXtyZXBvLmlkfSByZXBvPXtyZXBvfSAvPil9XHJcbiAgICAgICAgICAgICAgICAgICAgPC9UYWJQYW5lPlxyXG4gICAgICAgICAgICAgICAgPC9UYWJzPlxyXG5cdFx0XHQ8L2Rpdj5cclxuXHRcdFx0PHN0eWxlIGpzeD57YFxyXG5cdFx0XHRcdC5yb290IHtcclxuXHRcdFx0XHRcdGRpc3BsYXk6IGZsZXg7XHJcblx0XHRcdFx0XHRhbGlnbi1pdGVtczogZmxleC1zdGFydDtcclxuXHRcdFx0XHRcdHBhZGRpbmc6IDIwcHggMDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0LnVzZXItaW5mbyB7XHJcblx0XHRcdFx0XHR3aWR0aDogMjAwcHg7XHJcblx0XHRcdFx0XHRtYXJnaW4tcmlnaHQ6IDQwcHg7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdC51c2VyLW5hbWUge1xyXG5cdFx0XHRcdFx0Zm9udC1zaXplOiAyMHB4O1xyXG5cdFx0XHRcdFx0Zm9udC13ZWlnaHQ6IDMwMDtcclxuXHRcdFx0XHRcdG1hcmdpbi10b3A6IDEwcHg7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdC51c2VyLWF2YXRhciB7XHJcblx0XHRcdFx0XHR3aWR0aDogMTAwJTtcclxuXHRcdFx0XHRcdGJvcmRlci1yYWRpdXM6IDRweDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdGB9PC9zdHlsZT5cclxuXHRcdDwvPlxyXG5cdClcclxufVxyXG5cclxuY29uc3QgYXBpID0gcmVxdWlyZSgnLi4vbGliL2FwaScpXHJcbi8v6LCD55So77yaIOacjeWKoeerr+a4suafk2luZGV45pe2IC/lrqLmiLfnq6/lr7zoiKrliLBpbmRleOaXtlxyXG4vL+a1j+iniOWZqOeOr+Wig++8miBheGlvcy5nZXQoJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC94eHgnKVxyXG4vL25vZGXnjq/looPvvJogYXhpb3MuZ2V0KCdodHRwOi8vbG9jYWxob3N0OjgwL3h4eCcpXHJcbkluZGV4LmdldEluaXRpYWxQcm9wcyA9IGFzeW5jIChwcm9wcykgPT4ge1xyXG4gICAgY29uc3QgeyBjdHgsIHJlZHV4U3RvcmUgfSA9IHByb3BzXHJcbiAgICBjb25zb2xlLmxvZyhjdHgsIHJlZHV4U3RvcmUpXHJcbiAgICBjb25zb2xlLmxvZygnaW4gaW5kZXggZ2V0SW5pdGl0YWxQcm9wcycpXHJcbiAgICBjb25zdCB1c2VyID0gcmVkdXhTdG9yZS5nZXRTdGF0ZSgpLnVzZXI7XHJcbiAgICBpZiAoIXVzZXIgfHwgIXVzZXIuaWQgKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgbG9nZ2VkSW46IGZhbHNlXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKCFpc1NlcnZlcikgeyAvL+acjeWKoeerr+eOr+Wig+S4jeS9v+eUqOe8k+WtmFxyXG4gICAgICAgIGNvbnN0IHVzZXJSZXBvcyA9IGNhY2hlLmdldCgndXNlclJlcG9zJyk7XHJcbiAgICAgICAgY29uc3QgdXNlclN0YXJyZWRSZXBvcyA9IGNhY2hlLmdldCgndXNlclN0YXJyZWRSZXBvcycpXHJcbiAgICAgICAgaWYgKHVzZXJSZXBvcyAmJiB1c2VyU3RhcnJlZFJlcG9zKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBsb2dnZWRJbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHVzZXJSZXBvcyxcclxuICAgICAgICAgICAgICAgIHVzZXJTdGFycmVkUmVwb3MgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdXNlclJlcG9zUmVzcCA9IGF3YWl0IGFwaS5yZXF1ZXN0KFxyXG4gICAgICAgIHsgdXJsOiAnL3VzZXIvcmVwb3MnIH0sIFxyXG4gICAgICAgIGN0eC5yZXEsIFxyXG4gICAgICAgIGN0eC5yZXNcclxuICAgICk7XHJcbiAgICBjb25zdCB1c2VyU3RhcnJlZFJlcG9zUmVzcCA9IGF3YWl0IGFwaS5yZXF1ZXN0KFxyXG4gICAgICAgIHsgdXJsOiAnL3VzZXIvc3RhcnJlZCd9LFxyXG4gICAgICAgIGN0eC5yZXEsXHJcbiAgICAgICAgY3R4LnJlc1xyXG4gICAgKVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBsb2dnZWRJbjogdHJ1ZSxcclxuICAgICAgICB1c2VyUmVwb3M6IHVzZXJSZXBvc1Jlc3AuZGF0YSxcclxuICAgICAgICB1c2VyU3RhcnJlZFJlcG9zOiB1c2VyU3RhcnJlZFJlcG9zUmVzcC5kYXRhXHJcbiAgICB9XHJcbn1cclxuXHJcbiJdfQ== */\\n/*@ sourceURL=D:\\\\\\\\\\u7F16\\u7A0B\\\\\\\\\\u9879\\u76EE\\\\\\\\next\\u9879\\u76EE\\\\\\\\next-github\\\\\\\\pages\\\\\\\\index.js */\"));\n}\n\nvar api = require('../lib/api'); //调用： 服务端渲染index时 /客户端导航到index时\n//浏览器环境： axios.get('http://localhost:3000/xxx')\n//node环境： axios.get('http://localhost:80/xxx')\n\n\nIndex.getInitialProps = function _callee(props) {\n  var ctx, reduxStore, user, userRepos, userStarredRepos, userReposResp, userStarredReposResp;\n  return _regeneratorRuntime.async(function _callee$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          ctx = props.ctx, reduxStore = props.reduxStore;\n          console.log(ctx, reduxStore);\n          console.log('in index getInititalProps');\n          user = reduxStore.getState().user;\n\n          if (!(!user || !user.id)) {\n            _context.next = 6;\n            break;\n          }\n\n          return _context.abrupt(\"return\", {\n            loggedIn: false\n          });\n\n        case 6:\n          if (isServer) {\n            _context.next = 11;\n            break;\n          }\n\n          //服务端环境不使用缓存\n          userRepos = cache.get('userRepos');\n          userStarredRepos = cache.get('userStarredRepos');\n\n          if (!(userRepos && userStarredRepos)) {\n            _context.next = 11;\n            break;\n          }\n\n          return _context.abrupt(\"return\", {\n            loggedIn: true,\n            userRepos: userRepos,\n            userStarredRepos: userStarredRepos\n          });\n\n        case 11:\n          _context.next = 13;\n          return _regeneratorRuntime.awrap(api.request({\n            url: '/user/repos'\n          }, ctx.req, ctx.res));\n\n        case 13:\n          userReposResp = _context.sent;\n          _context.next = 16;\n          return _regeneratorRuntime.awrap(api.request({\n            url: '/user/starred'\n          }, ctx.req, ctx.res));\n\n        case 16:\n          userStarredReposResp = _context.sent;\n          return _context.abrupt(\"return\", {\n            loggedIn: true,\n            userRepos: userReposResp.data,\n            userStarredRepos: userStarredReposResp.data\n          });\n\n        case 18:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  });\n};","map":{"version":3,"sources":["D:/编程/项目/next项目/next-github/pages/index.js"],"names":["useSelector","useState","useEffect","Repo","config","LRU","Router","useRouter","OAUTH_URL","TabPane","cache","maxAge","isServer","Index","loggedIn","userRepos","userStarredRepos","router","activeTabKey","query","key","handleTabChange","push","set","BeforeLogin","setLoggedIn","user","avatar_url","login","map","repo","id","api","require","getInitialProps","props","ctx","reduxStore","console","log","getState","get","request","url","req","res","userReposResp","userStarredReposResp","data"],"mappings":"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","sourcesContent":["import { useSelector } from 'react-redux'\r\nimport { Button, Tabs } from 'antd'\r\nimport { useState, useEffect } from 'react'\r\nimport Repo from '../components/Repo'\r\nimport config from '../config'\r\nimport LRU from 'lru-cache'\r\nimport  Router, { useRouter } from 'next/router'\r\n\r\nconst { OAUTH_URL } = config;\r\nconst { TabPane } = Tabs;\r\nconst cache = new LRU({\r\n    maxAge: 1000 * 60 * 30 //30min\r\n})\r\nconst isServer = typeof window === undefined\r\n\r\nexport default function Index({ loggedIn, userRepos, userStarredRepos }) {\r\n    // const user = useSelector(state => state.user);\r\n    // const initLoggedIn = user && user.id;\r\n    // const [userRepos, setUserRepos] = useState([]);\r\n    // const [userStarredRepos, setUserStarredRepos] = useState([]);\r\n    // const [loggedIn, setLoggedIn] = useState(initLoggedIn);\r\n    const router = useRouter();\r\n    const activeTabKey = router.query.key || 'repos';\r\n\r\n    const handleTabChange = (activeTabKey) => {\r\n        Router.push(`/?key=${activeTabKey}`)\r\n    }\r\n\r\n\t// useEffect(() => {\r\n    //     if (loggedIn) { \r\n    //         if (cache.get('userRepos') && cache.get('userStarredRepos')) {\r\n    //             return;\r\n    //         }\r\n    //         (async () => {\r\n    //             const userRepos = await api.request(\r\n    //                 { url: '/user/repos' }, \r\n    //             )\r\n    //             const userStarredRepos = await api.request(\r\n    //                 { url: '/user/starred' }\r\n    //             )\r\n    //             setUserRepos(userRepos.data);\r\n    //             setUserStarredRepos(userStarredRepos.data)\r\n    //         })()\r\n    //     }\r\n    // }, [loggedIn])\r\n    \r\n    useEffect(() => {\r\n        if (!isServer) { //服务端环境不使用缓存\r\n            userRepos && cache.set('userRepos', userRepos)\r\n            userStarredRepos &&  cache.set('userStarredRepos', userStarredRepos)\r\n        }\r\n    }, [userRepos, userStarredRepos])\r\n\r\n\tconst BeforeLogin = () => (\r\n\t\t<>\r\n\t\t\t<div className=\"root\">\r\n\t\t\t\t<Button href={OAUTH_URL} onClick={() => setLoggedIn(true)}>\r\n                    未登录，请点击登录\r\n                </Button>\r\n\t\t\t</div>\r\n\t\t\t<style jsx>{`\r\n\t\t\t\t.root {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tjustify-content: center;\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t}\r\n\t\t\t`}</style>\r\n\t\t</>\r\n\t)\r\n\t\r\n\tif (!loggedIn) {\r\n\t\treturn <BeforeLogin />\r\n\t}\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<div className=\"root\">\r\n\t\t\t\t<div className=\"user-info\">\r\n\t\t\t\t\t<img src={user.avatar_url} alt=\"user avatar\" className=\"user-avatar\"/>\r\n\t\t\t\t\t<p className=\"user-name\">{user.login}</p>\r\n\t\t\t\t</div>\r\n                <Tabs activeKey={activeTabKey} onChange={handleTabChange}>\r\n                    <TabPane key=\"repos\" tab=\"Repositories\">\r\n                        {/* <div className=\"user-repos\"> */}\r\n                            {userRepos.map(repo => <Repo key={repo.id} repo={repo} />)}\r\n                        {/* </div> */}\r\n                    </TabPane>\r\n                    <TabPane key=\"stars\" tab=\"Stars\">\r\n                        {userStarredRepos.map(repo => <Repo key={repo.id} repo={repo} />)}\r\n                    </TabPane>\r\n                </Tabs>\r\n\t\t\t</div>\r\n\t\t\t<style jsx>{`\r\n\t\t\t\t.root {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\talign-items: flex-start;\r\n\t\t\t\t\tpadding: 20px 0;\r\n\t\t\t\t}\r\n\t\t\t\t.user-info {\r\n\t\t\t\t\twidth: 200px;\r\n\t\t\t\t\tmargin-right: 40px;\r\n\t\t\t\t}\r\n\t\t\t\t.user-name {\r\n\t\t\t\t\tfont-size: 20px;\r\n\t\t\t\t\tfont-weight: 300;\r\n\t\t\t\t\tmargin-top: 10px;\r\n\t\t\t\t}\r\n\t\t\t\t.user-avatar {\r\n\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\tborder-radius: 4px;\r\n\t\t\t\t}\r\n\t\t\t`}</style>\r\n\t\t</>\r\n\t)\r\n}\r\n\r\nconst api = require('../lib/api')\r\n//调用： 服务端渲染index时 /客户端导航到index时\r\n//浏览器环境： axios.get('http://localhost:3000/xxx')\r\n//node环境： axios.get('http://localhost:80/xxx')\r\nIndex.getInitialProps = async (props) => {\r\n    const { ctx, reduxStore } = props\r\n    console.log(ctx, reduxStore)\r\n    console.log('in index getInititalProps')\r\n    const user = reduxStore.getState().user;\r\n    if (!user || !user.id ) {\r\n        return {\r\n            loggedIn: false\r\n        }\r\n    }\r\n    if (!isServer) { //服务端环境不使用缓存\r\n        const userRepos = cache.get('userRepos');\r\n        const userStarredRepos = cache.get('userStarredRepos')\r\n        if (userRepos && userStarredRepos) {\r\n            return {\r\n                loggedIn: true,\r\n                userRepos,\r\n                userStarredRepos    \r\n            }\r\n        }\r\n    }\r\n\r\n    const userReposResp = await api.request(\r\n        { url: '/user/repos' }, \r\n        ctx.req, \r\n        ctx.res\r\n    );\r\n    const userStarredReposResp = await api.request(\r\n        { url: '/user/starred'},\r\n        ctx.req,\r\n        ctx.res\r\n    )\r\n    return {\r\n        loggedIn: true,\r\n        userRepos: userReposResp.data,\r\n        userStarredRepos: userStarredReposResp.data\r\n    }\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}