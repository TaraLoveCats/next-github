{"ast":null,"code":"import _Result from \"antd/lib/result\";\nimport _Button from \"antd/lib/button\";\nimport _Icon from \"antd/lib/icon\";\nimport _Tabs from \"antd/lib/tabs\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useSelector } from 'react-redux';\nimport { useEffect } from 'react';\nimport Repo from '../components/Repo';\nimport config from '../config';\nimport LRU from 'lru-cache';\nimport Router, { useRouter } from 'next/router';\nimport { cacheArray } from '../lib/repo-basic-cache';\nconst {\n  TabPane\n} = _Tabs;\nconst cache = new LRU({\n  maxAge: 1000 * 60 * 30 //30min\n\n});\nconst isServer = true;\nexport default function Index({\n  userRepos = [],\n  userStarredRepos = [],\n  colors\n}) {\n  console.log('colors', colors);\n  const user = useSelector(state => state.user);\n  const router = useRouter();\n  const activeTabKey = router.query.key || 'repos';\n\n  const handleTabChange = activeTabKey => {\n    Router.push(`/?key=${activeTabKey}`);\n  }; //在Index页面不频繁请求repo信息\n\n\n  useEffect(() => {\n    if (!isServer) {\n      userRepos && cache.set('userRepos', userRepos);\n      userStarredRepos && cache.set('userStarredRepos', userStarredRepos);\n    }\n  }, [userRepos, userStarredRepos]); //跳转到/search页面不用重新请求repo信息\n\n  useEffect(() => {\n    if (!isServer) {\n      cacheArray(userRepos);\n      cacheArray(userStarredRepos);\n    }\n  });\n\n  const BeforeLogin = () => __jsx(React.Fragment, null, __jsx(_Result, {\n    status: null,\n    icon: __jsx(_Icon, {\n      type: \"github\"\n    }),\n    title: \"Click the button to login into your Github account\",\n    extra: __jsx(_Button, {\n      type: \"primary\",\n      href: config.OAUTH_URL\n    }, \"Log in\")\n  }));\n\n  if (!user || !user.id) {\n    return __jsx(BeforeLogin, null);\n  }\n\n  return __jsx(React.Fragment, null, __jsx(\"div\", {\n    className: \"jsx-1042228906\" + \" \" + \"root\"\n  }, __jsx(\"div\", {\n    className: \"jsx-1042228906\" + \" \" + \"user-info\"\n  }, __jsx(\"img\", {\n    src: user.avatar_url,\n    alt: \"user avatar\",\n    className: \"jsx-1042228906\" + \" \" + \"user-avatar\"\n  }), __jsx(\"p\", {\n    className: \"jsx-1042228906\" + \" \" + \"user-name\"\n  }, user.login)), __jsx(_Tabs, {\n    activeKey: activeTabKey,\n    onChange: handleTabChange,\n    animated: false,\n    size: \"large\"\n  }, __jsx(TabPane, {\n    key: \"repos\",\n    tab: \"Repositories\"\n  }, userRepos.map(repo => __jsx(Repo, {\n    key: repo.id,\n    repo: repo\n  }))), __jsx(TabPane, {\n    key: \"stars\",\n    tab: \"Stars\"\n  }, userStarredRepos.map(repo => __jsx(Repo, {\n    key: repo.id,\n    repo: repo\n  }))))), __jsx(_JSXStyle, {\n    id: \"1042228906\"\n  }, \".root.jsx-1042228906{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;padding:20px 0;}.user-info.jsx-1042228906{width:200px;margin-right:40px;}.user-name.jsx-1042228906{font-size:20px;font-weight:300;margin-top:10px;}.user-avatar.jsx-1042228906{width:100%;border-radius:4px;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkQ6XFznvJbnqItcXOmhueebrlxcbmV4dOmhueebrlxcbmV4dC1naXRodWJcXHBhZ2VzXFxpbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUE2RWUsQUFHbUIsQUFLRCxBQUlHLEFBS0osV0FDTyxDQVRBLEdBSUYsY0FNakIsQ0FUQSxDQUlpQixnQkFDakIsMkJBWHdCLDZHQUNSLGVBQ2hCIiwiZmlsZSI6IkQ6XFznvJbnqItcXOmhueebrlxcbmV4dOmhueebrlxcbmV4dC1naXRodWJcXHBhZ2VzXFxpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZVNlbGVjdG9yIH0gZnJvbSAncmVhY3QtcmVkdXgnXHJcbmltcG9ydCB7IEJ1dHRvbiwgVGFicywgUmVzdWx0LCBJY29uIH0gZnJvbSAnYW50ZCdcclxuaW1wb3J0IHsgdXNlRWZmZWN0IH0gZnJvbSAncmVhY3QnXHJcbmltcG9ydCBSZXBvIGZyb20gJy4uL2NvbXBvbmVudHMvUmVwbydcclxuaW1wb3J0IGNvbmZpZyBmcm9tICcuLi9jb25maWcnXHJcbmltcG9ydCBMUlUgZnJvbSAnbHJ1LWNhY2hlJ1xyXG5pbXBvcnQgIFJvdXRlciwgeyB1c2VSb3V0ZXIgfSBmcm9tICduZXh0L3JvdXRlcidcclxuaW1wb3J0IHsgY2FjaGVBcnJheSB9IGZyb20gJy4uL2xpYi9yZXBvLWJhc2ljLWNhY2hlJ1xyXG5cclxuY29uc3QgeyBUYWJQYW5lIH0gPSBUYWJzO1xyXG5jb25zdCBjYWNoZSA9IG5ldyBMUlUoe1xyXG4gICAgbWF4QWdlOiAxMDAwICogNjAgKiAzMCAvLzMwbWluXHJcbn0pXHJcbmNvbnN0IGlzU2VydmVyID0gdHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBJbmRleCh7IHVzZXJSZXBvcyA9IFtdLCB1c2VyU3RhcnJlZFJlcG9zID0gW10sIGNvbG9ycyB9KSB7XHJcbiAgICBjb25zb2xlLmxvZygnY29sb3JzJywgY29sb3JzKVxyXG4gICAgY29uc3QgdXNlciA9IHVzZVNlbGVjdG9yKHN0YXRlID0+IHN0YXRlLnVzZXIpO1xyXG4gICAgY29uc3Qgcm91dGVyID0gdXNlUm91dGVyKCk7XHJcbiAgICBjb25zdCBhY3RpdmVUYWJLZXkgPSByb3V0ZXIucXVlcnkua2V5IHx8ICdyZXBvcyc7XHJcblxyXG4gICAgY29uc3QgaGFuZGxlVGFiQ2hhbmdlID0gKGFjdGl2ZVRhYktleSkgPT4ge1xyXG4gICAgICAgIFJvdXRlci5wdXNoKGAvP2tleT0ke2FjdGl2ZVRhYktleX1gKVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvL+WcqEluZGV46aG16Z2i5LiN6aKR57mB6K+35rGCcmVwb+S/oeaBr1xyXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgICAgICBpZiAoIWlzU2VydmVyKSB7IFxyXG4gICAgICAgICAgICB1c2VyUmVwb3MgJiYgY2FjaGUuc2V0KCd1c2VyUmVwb3MnLCB1c2VyUmVwb3MpXHJcbiAgICAgICAgICAgIHVzZXJTdGFycmVkUmVwb3MgJiYgIGNhY2hlLnNldCgndXNlclN0YXJyZWRSZXBvcycsIHVzZXJTdGFycmVkUmVwb3MpXHJcbiAgICAgICAgfVxyXG4gICAgfSwgW3VzZXJSZXBvcywgdXNlclN0YXJyZWRSZXBvc10pXHJcblxyXG4gICAgLy/ot7PovazliLAvc2VhcmNo6aG16Z2i5LiN55So6YeN5paw6K+35rGCcmVwb+S/oeaBr1xyXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgICAgICBpZiAoIWlzU2VydmVyKSB7XHJcbiAgICAgICAgICAgIGNhY2hlQXJyYXkodXNlclJlcG9zKVxyXG4gICAgICAgICAgICBjYWNoZUFycmF5KHVzZXJTdGFycmVkUmVwb3MpXHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxuXHJcblx0Y29uc3QgQmVmb3JlTG9naW4gPSAoKSA9PiAoXHJcblx0XHQ8PlxyXG4gICAgICAgICAgICA8UmVzdWx0XHJcbiAgICAgICAgICAgICAgICBzdGF0dXM9e251bGx9XHJcbiAgICAgICAgICAgICAgICBpY29uPXs8SWNvbiB0eXBlPVwiZ2l0aHViXCIgLz59XHJcbiAgICAgICAgICAgICAgICB0aXRsZT1cIkNsaWNrIHRoZSBidXR0b24gdG8gbG9naW4gaW50byB5b3VyIEdpdGh1YiBhY2NvdW50XCJcclxuICAgICAgICAgICAgICAgIGV4dHJhPXs8QnV0dG9uIHR5cGU9XCJwcmltYXJ5XCIgaHJlZj17Y29uZmlnLk9BVVRIX1VSTH0+TG9nIGluPC9CdXR0b24+fVxyXG4gICAgICAgICAgICAvPlxyXG5cdFx0PC8+XHJcblx0KVxyXG5cdFxyXG5cdGlmICghdXNlciB8fCAhdXNlci5pZCkge1xyXG5cdFx0cmV0dXJuIDxCZWZvcmVMb2dpbiAvPlxyXG5cdH1cclxuXHJcblx0cmV0dXJuIChcclxuXHRcdDw+XHJcblx0XHRcdDxkaXYgY2xhc3NOYW1lPVwicm9vdFwiPlxyXG5cdFx0XHRcdDxkaXYgY2xhc3NOYW1lPVwidXNlci1pbmZvXCI+XHJcblx0XHRcdFx0XHQ8aW1nIHNyYz17dXNlci5hdmF0YXJfdXJsfSBhbHQ9XCJ1c2VyIGF2YXRhclwiIGNsYXNzTmFtZT1cInVzZXItYXZhdGFyXCIvPlxyXG5cdFx0XHRcdFx0PHAgY2xhc3NOYW1lPVwidXNlci1uYW1lXCI+e3VzZXIubG9naW59PC9wPlxyXG5cdFx0XHRcdDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgPFRhYnMgXHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlS2V5PXthY3RpdmVUYWJLZXl9IFxyXG4gICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXtoYW5kbGVUYWJDaGFuZ2V9IFxyXG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGVkPXtmYWxzZX1cclxuICAgICAgICAgICAgICAgICAgICBzaXplPVwibGFyZ2VcIlxyXG4gICAgICAgICAgICAgICAgPlxyXG4gICAgICAgICAgICAgICAgICAgIDxUYWJQYW5lIGtleT1cInJlcG9zXCIgdGFiPVwiUmVwb3NpdG9yaWVzXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHt1c2VyUmVwb3MubWFwKHJlcG8gPT4gPFJlcG8ga2V5PXtyZXBvLmlkfSByZXBvPXtyZXBvfSAvPil9XHJcbiAgICAgICAgICAgICAgICAgICAgPC9UYWJQYW5lPlxyXG4gICAgICAgICAgICAgICAgICAgIDxUYWJQYW5lIGtleT1cInN0YXJzXCIgdGFiPVwiU3RhcnNcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAge3VzZXJTdGFycmVkUmVwb3MubWFwKHJlcG8gPT4gPFJlcG8ga2V5PXtyZXBvLmlkfSByZXBvPXtyZXBvfSAvPil9XHJcbiAgICAgICAgICAgICAgICAgICAgPC9UYWJQYW5lPlxyXG4gICAgICAgICAgICAgICAgPC9UYWJzPlxyXG5cdFx0XHQ8L2Rpdj5cclxuXHRcdFx0PHN0eWxlIGpzeD57YFxyXG5cdFx0XHRcdC5yb290IHtcclxuXHRcdFx0XHRcdGRpc3BsYXk6IGZsZXg7XHJcblx0XHRcdFx0XHRhbGlnbi1pdGVtczogZmxleC1zdGFydDtcclxuXHRcdFx0XHRcdHBhZGRpbmc6IDIwcHggMDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0LnVzZXItaW5mbyB7XHJcblx0XHRcdFx0XHR3aWR0aDogMjAwcHg7XHJcblx0XHRcdFx0XHRtYXJnaW4tcmlnaHQ6IDQwcHg7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdC51c2VyLW5hbWUge1xyXG5cdFx0XHRcdFx0Zm9udC1zaXplOiAyMHB4O1xyXG5cdFx0XHRcdFx0Zm9udC13ZWlnaHQ6IDMwMDtcclxuXHRcdFx0XHRcdG1hcmdpbi10b3A6IDEwcHg7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdC51c2VyLWF2YXRhciB7XHJcblx0XHRcdFx0XHR3aWR0aDogMTAwJTtcclxuXHRcdFx0XHRcdGJvcmRlci1yYWRpdXM6IDRweDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdGB9PC9zdHlsZT5cclxuXHRcdDwvPlxyXG5cdClcclxufVxyXG5cclxuY29uc3QgYXBpID0gcmVxdWlyZSgnLi4vbGliL2FwaScpXHJcblxyXG4vL+iwg+eUqO+8miDmnI3liqHnq6/muLLmn5NpbmRleOaXtiAv5a6i5oi356uv5a+86Iiq5YiwaW5kZXjml7ZcclxuSW5kZXguZ2V0SW5pdGlhbFByb3BzID0gYXN5bmMgKHsgcmVxLCByZXMsIHJlZHV4U3RvcmUgfSkgPT4ge1xyXG4gICAgY29uc3QgdXNlciA9IHJlZHV4U3RvcmUuZ2V0U3RhdGUoKS51c2VyO1xyXG4gICAgaWYgKCF1c2VyIHx8ICF1c2VyLmlkICkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHVzZXJSZXBvczogbnVsbCxcclxuICAgICAgICAgICAgdXNlclN0YXJyZWRSZXBvczogbnVsbFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICghaXNTZXJ2ZXIpIHsgLy/mnI3liqHnq6/njq/looPkuI3kvb/nlKjnvJPlrZhcclxuICAgICAgICBjb25zdCB1c2VyUmVwb3MgPSBjYWNoZS5nZXQoJ3VzZXJSZXBvcycpO1xyXG4gICAgICAgIGNvbnN0IHVzZXJTdGFycmVkUmVwb3MgPSBjYWNoZS5nZXQoJ3VzZXJTdGFycmVkUmVwb3MnKVxyXG4gICAgICAgIGlmICh1c2VyUmVwb3MgJiYgdXNlclN0YXJyZWRSZXBvcykge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgdXNlclJlcG9zLFxyXG4gICAgICAgICAgICAgICAgdXNlclN0YXJyZWRSZXBvcyAgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB1c2VyUmVwb3NSZXNwID0gYXdhaXQgYXBpLnJlcXVlc3QoXHJcbiAgICAgICAgeyB1cmw6ICcvdXNlci9yZXBvcycgfSwgXHJcbiAgICAgICAgcmVxLCBcclxuICAgICAgICByZXNcclxuICAgICk7XHJcbiAgICBjb25zdCB1c2VyU3RhcnJlZFJlcG9zUmVzcCA9IGF3YWl0IGFwaS5yZXF1ZXN0KFxyXG4gICAgICAgIHsgdXJsOiAnL3VzZXIvc3RhcnJlZCd9LFxyXG4gICAgICAgIHJlcSxcclxuICAgICAgICByZXNcclxuICAgICk7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHVzZXJSZXBvczogdXNlclJlcG9zUmVzcC5kYXRhIHx8IFtdLFxyXG4gICAgICAgIHVzZXJTdGFycmVkUmVwb3M6IHVzZXJTdGFycmVkUmVwb3NSZXNwLmRhdGEgfHwgW11cclxuICAgIH1cclxufVxyXG5cclxuIl19 */\\n/*@ sourceURL=D:\\\\\\\\\\u7F16\\u7A0B\\\\\\\\\\u9879\\u76EE\\\\\\\\next\\u9879\\u76EE\\\\\\\\next-github\\\\\\\\pages\\\\\\\\index.js */\"));\n}\n\nconst api = require('../lib/api'); //调用： 服务端渲染index时 /客户端导航到index时\n\n\nIndex.getInitialProps = async ({\n  req,\n  res,\n  reduxStore\n}) => {\n  const user = reduxStore.getState().user;\n\n  if (!user || !user.id) {\n    return {\n      userRepos: null,\n      userStarredRepos: null\n    };\n  }\n\n  if (!isServer) {\n    //服务端环境不使用缓存\n    const userRepos = cache.get('userRepos');\n    const userStarredRepos = cache.get('userStarredRepos');\n\n    if (userRepos && userStarredRepos) {\n      return {\n        userRepos,\n        userStarredRepos\n      };\n    }\n  }\n\n  const userReposResp = await api.request({\n    url: '/user/repos'\n  }, req, res);\n  const userStarredReposResp = await api.request({\n    url: '/user/starred'\n  }, req, res);\n  return {\n    userRepos: userReposResp.data || [],\n    userStarredRepos: userStarredReposResp.data || []\n  };\n};","map":{"version":3,"sources":["D:/编程/项目/next项目/next-github/pages/index.js"],"names":["useSelector","useEffect","Repo","config","LRU","Router","useRouter","cacheArray","TabPane","cache","maxAge","isServer","Index","userRepos","userStarredRepos","colors","console","log","user","state","router","activeTabKey","query","key","handleTabChange","push","set","BeforeLogin","OAUTH_URL","id","avatar_url","login","map","repo","api","require","getInitialProps","req","res","reduxStore","getState","get","userReposResp","request","url","userStarredReposResp","data"],"mappings":"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","sourcesContent":["import { useSelector } from 'react-redux'\r\nimport { Button, Tabs, Result, Icon } from 'antd'\r\nimport { useEffect } from 'react'\r\nimport Repo from '../components/Repo'\r\nimport config from '../config'\r\nimport LRU from 'lru-cache'\r\nimport  Router, { useRouter } from 'next/router'\r\nimport { cacheArray } from '../lib/repo-basic-cache'\r\n\r\nconst { TabPane } = Tabs;\r\nconst cache = new LRU({\r\n    maxAge: 1000 * 60 * 30 //30min\r\n})\r\nconst isServer = typeof window === 'undefined';\r\n\r\nexport default function Index({ userRepos = [], userStarredRepos = [], colors }) {\r\n    console.log('colors', colors)\r\n    const user = useSelector(state => state.user);\r\n    const router = useRouter();\r\n    const activeTabKey = router.query.key || 'repos';\r\n\r\n    const handleTabChange = (activeTabKey) => {\r\n        Router.push(`/?key=${activeTabKey}`)\r\n    }\r\n    \r\n    //在Index页面不频繁请求repo信息\r\n    useEffect(() => {\r\n        if (!isServer) { \r\n            userRepos && cache.set('userRepos', userRepos)\r\n            userStarredRepos &&  cache.set('userStarredRepos', userStarredRepos)\r\n        }\r\n    }, [userRepos, userStarredRepos])\r\n\r\n    //跳转到/search页面不用重新请求repo信息\r\n    useEffect(() => {\r\n        if (!isServer) {\r\n            cacheArray(userRepos)\r\n            cacheArray(userStarredRepos)\r\n        }\r\n    })\r\n\r\n\tconst BeforeLogin = () => (\r\n\t\t<>\r\n            <Result\r\n                status={null}\r\n                icon={<Icon type=\"github\" />}\r\n                title=\"Click the button to login into your Github account\"\r\n                extra={<Button type=\"primary\" href={config.OAUTH_URL}>Log in</Button>}\r\n            />\r\n\t\t</>\r\n\t)\r\n\t\r\n\tif (!user || !user.id) {\r\n\t\treturn <BeforeLogin />\r\n\t}\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<div className=\"root\">\r\n\t\t\t\t<div className=\"user-info\">\r\n\t\t\t\t\t<img src={user.avatar_url} alt=\"user avatar\" className=\"user-avatar\"/>\r\n\t\t\t\t\t<p className=\"user-name\">{user.login}</p>\r\n\t\t\t\t</div>\r\n                <Tabs \r\n                    activeKey={activeTabKey} \r\n                    onChange={handleTabChange} \r\n                    animated={false}\r\n                    size=\"large\"\r\n                >\r\n                    <TabPane key=\"repos\" tab=\"Repositories\">\r\n                        {userRepos.map(repo => <Repo key={repo.id} repo={repo} />)}\r\n                    </TabPane>\r\n                    <TabPane key=\"stars\" tab=\"Stars\">\r\n                        {userStarredRepos.map(repo => <Repo key={repo.id} repo={repo} />)}\r\n                    </TabPane>\r\n                </Tabs>\r\n\t\t\t</div>\r\n\t\t\t<style jsx>{`\r\n\t\t\t\t.root {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\talign-items: flex-start;\r\n\t\t\t\t\tpadding: 20px 0;\r\n\t\t\t\t}\r\n\t\t\t\t.user-info {\r\n\t\t\t\t\twidth: 200px;\r\n\t\t\t\t\tmargin-right: 40px;\r\n\t\t\t\t}\r\n\t\t\t\t.user-name {\r\n\t\t\t\t\tfont-size: 20px;\r\n\t\t\t\t\tfont-weight: 300;\r\n\t\t\t\t\tmargin-top: 10px;\r\n\t\t\t\t}\r\n\t\t\t\t.user-avatar {\r\n\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\tborder-radius: 4px;\r\n\t\t\t\t}\r\n\t\t\t`}</style>\r\n\t\t</>\r\n\t)\r\n}\r\n\r\nconst api = require('../lib/api')\r\n\r\n//调用： 服务端渲染index时 /客户端导航到index时\r\nIndex.getInitialProps = async ({ req, res, reduxStore }) => {\r\n    const user = reduxStore.getState().user;\r\n    if (!user || !user.id ) {\r\n        return {\r\n            userRepos: null,\r\n            userStarredRepos: null\r\n        }\r\n    }\r\n    if (!isServer) { //服务端环境不使用缓存\r\n        const userRepos = cache.get('userRepos');\r\n        const userStarredRepos = cache.get('userStarredRepos')\r\n        if (userRepos && userStarredRepos) {\r\n            return {\r\n                userRepos,\r\n                userStarredRepos    \r\n            }\r\n        }\r\n    }\r\n\r\n    const userReposResp = await api.request(\r\n        { url: '/user/repos' }, \r\n        req, \r\n        res\r\n    );\r\n    const userStarredReposResp = await api.request(\r\n        { url: '/user/starred'},\r\n        req,\r\n        res\r\n    );\r\n    return {\r\n        userRepos: userReposResp.data || [],\r\n        userStarredRepos: userStarredReposResp.data || []\r\n    }\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}