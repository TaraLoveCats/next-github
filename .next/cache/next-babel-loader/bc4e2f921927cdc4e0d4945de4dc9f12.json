{"ast":null,"code":"const axios = require('axios');\n\nconst github_base_url = 'https://api.github.com';\nconst isServer = false; //客户端和服务器端最终调用的方法\n\nasync function requestGithub(method, url, data, headers) {\n  return await axios({\n    method,\n    url: `${github_base_url}${url}`,\n    data,\n    headers\n  });\n}\n\nasync function request({\n  method = 'GET',\n  url,\n  data = {}\n}, req, res) {\n  if (!url) {\n    throw Error('url must be provided');\n  }\n\n  if (isServer) {\n    //是服务端环境直接请求github数据\n    const session = ctx.session;\n    const githubAuth = session.githubAuth || {};\n    const headers = {};\n    const token = githubAuth && githubAuth.access_token;\n\n    if (token) {\n      headers['Authorization'] = `${githubAuth.token_type} ${token}`;\n    }\n\n    return await requestGithub(method, url, data, headers);\n  } else {\n    //客户端环境使用github api代理（ koa处理server/api ）\n    return await axios({\n      method,\n      url: `/github/${url}`,\n      data\n    });\n  }\n}\n\nmodule.exports = {\n  request,\n  requestGithub\n};","map":{"version":3,"sources":["D:/编程/项目/next项目/next-github/lib/api.js"],"names":["axios","require","github_base_url","isServer","requestGithub","method","url","data","headers","request","req","res","Error","session","ctx","githubAuth","token","access_token","token_type","module","exports"],"mappings":"AAAA,MAAMA,KAAK,GAAGC,OAAO,CAAC,OAAD,CAArB;;AAEA,MAAMC,eAAe,GAAG,wBAAxB;AACA,MAAMC,QAAQ,QAAd,C,CAEA;;AACA,eAAeC,aAAf,CAA6BC,MAA7B,EAAqCC,GAArC,EAA0CC,IAA1C,EAAgDC,OAAhD,EAAyD;AACrD,SAAO,MAAMR,KAAK,CAAC;AACfK,IAAAA,MADe;AAEfC,IAAAA,GAAG,EAAG,GAAEJ,eAAgB,GAAEI,GAAI,EAFf;AAGfC,IAAAA,IAHe;AAIfC,IAAAA;AAJe,GAAD,CAAlB;AAMH;;AAED,eAAeC,OAAf,CAAuB;AAAEJ,EAAAA,MAAM,GAAG,KAAX;AAAkBC,EAAAA,GAAlB;AAAuBC,EAAAA,IAAI,GAAG;AAA9B,CAAvB,EAA0DG,GAA1D,EAA+DC,GAA/D,EAAoE;AAChE,MAAI,CAACL,GAAL,EAAU;AACN,UAAMM,KAAK,CAAC,sBAAD,CAAX;AACH;;AACD,MAAIT,QAAJ,EAAc;AACV;AACA,UAAMU,OAAO,GAAGC,GAAG,CAACD,OAApB;AACA,UAAME,UAAU,GAAGF,OAAO,CAACE,UAAR,IAAsB,EAAzC;AACA,UAAMP,OAAO,GAAG,EAAhB;AACA,UAAMQ,KAAK,GAAGD,UAAU,IAAIA,UAAU,CAACE,YAAvC;;AACA,QAAID,KAAJ,EAAW;AACPR,MAAAA,OAAO,CAAC,eAAD,CAAP,GAA4B,GAAEO,UAAU,CAACG,UAAW,IAAGF,KAAM,EAA7D;AACH;;AACD,WAAO,MAAMZ,aAAa,CAACC,MAAD,EAASC,GAAT,EAAcC,IAAd,EAAoBC,OAApB,CAA1B;AAEH,GAXD,MAWO;AACH;AACA,WAAO,MAAMR,KAAK,CAAC;AACfK,MAAAA,MADe;AAEfC,MAAAA,GAAG,EAAG,WAAUA,GAAI,EAFL;AAGfC,MAAAA;AAHe,KAAD,CAAlB;AAKH;AACJ;;AAEDY,MAAM,CAACC,OAAP,GAAiB;AACbX,EAAAA,OADa;AAEbL,EAAAA;AAFa,CAAjB","sourcesContent":["const axios = require('axios')\r\n\r\nconst github_base_url = 'https://api.github.com'\r\nconst isServer = typeof window === undefined\r\n\r\n//客户端和服务器端最终调用的方法\r\nasync function requestGithub(method, url, data, headers) {\r\n    return await axios({\r\n        method,\r\n        url: `${github_base_url}${url}`,\r\n        data,\r\n        headers\r\n    })\r\n}\r\n\r\nasync function request({ method = 'GET', url, data = {}}, req, res) {\r\n    if (!url) {\r\n        throw Error('url must be provided')\r\n    }\r\n    if (isServer) {\r\n        //是服务端环境直接请求github数据\r\n        const session = ctx.session\r\n        const githubAuth = session.githubAuth || {}\r\n        const headers = {}\r\n        const token = githubAuth && githubAuth.access_token\r\n        if (token) {\r\n            headers['Authorization'] = `${githubAuth.token_type} ${token}`\r\n        }\r\n        return await requestGithub(method, url, data, headers)\r\n\r\n    } else {\r\n        //客户端环境使用github api代理（ koa处理server/api ）\r\n        return await axios({\r\n            method,\r\n            url: `/github/${url}`,\r\n            data\r\n        })\r\n    }\r\n}\r\n\r\nmodule.exports = {\r\n    request,\r\n    requestGithub\r\n}"]},"metadata":{},"sourceType":"script"}